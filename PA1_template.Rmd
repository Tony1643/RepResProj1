# Activity Monitoring #

## Data ##

57,568 observations on three variables: **steps**, **date** and **interval** are read into an R data table, *steps_taken*, from the csv file *activity.csv*. Libraries to be used in the analysis are also made available.


```{r}
setwd("D:/Documents/DataScience/proj1")
library(data.table)
library(ggplot2)
steps_taken <- data.table(read.table("activity.csv", sep=",", header = TRUE, na.strings = "NA"))
```

## Total Steps per Day ##

A histogram of the total number of steps taken per day is made. 

```{r fig.width=7, fig.height=6}
hist(aggregate(steps ~ date, steps_taken, sum)$steps, 
     main="Total number of steps per day",
     xlab = "Steps per day")
mean_steps <- data.table(aggregate(steps ~ date, steps_taken, mean, na.rm=TRUE))
median_steps <- data.table(aggregate(steps ~ date, steps_taken, median, na.rm = TRUE))
```

The mean number of steps per day are.

```{r}
mean_steps
```

The median number of steps per day are.

```{r}
median_steps
```

It is noted that 53 days in the 61 day period have means and medians reported. The other eight days consist of missing values (NA) in the dataset.

## Average Daily Activity Pattern ##

The mean number of steps per interval, averaged over all days, are calculated.

```{r}
by_interval <- data.table(aggregate(steps ~ interval, steps_taken, mean, na.rm=TRUE))
```

These means are plotted against the period to give a time series plot.

```{r fig.width=7, fig.height=6}
p <- ggplot(by_interval, aes(x=interval, y=steps))+ geom_line()
p + xlab("Interval") + ylab("Steps") + ggtitle("Mean steps per time interval")
```

The maximum average number of steps is `r max(by_interval$steps)` and occurs in time period `r by_interval$interval[which.max(by_interval$steps)]`.

## Inputing Missing Values ##

As previously stated, there are missing values for eight days: in total  `r nrow(steps_taken[!complete.cases(steps_taken),])` missing values, which with 288 intervals per day, confirms `r nrow(steps_taken[!complete.cases(steps_taken),])/288` complete days unmeasured.

These missing values are imputed using the mean number of steps of the interval within which the missing value occurs. Added to the data table *steps_taken* is a variable, **imputed** which holds the imputed mean if *steps* is NA or the value of *steps* otherwise.

```{r}
setkey(steps_taken, interval)
setkey(by_interval, interval)
steps_taken$means <- rep(by_interval$steps, each=61)
steps_taken$imputed <- ifelse(is.na(steps_taken$steps), steps_taken$means, steps_taken$steps)
```

A histogram of the total number of steps taken each day is shown below.

```{r fig.width=7, fig.height=6}
hist(aggregate(imputed ~ date, steps_taken, sum)$imputed, 
     main="Imputed /n Total number of steps per day",
     xlab = "Steps per day")
mean_steps_imp <- data.table(aggregate(imputed ~ date, steps_taken, mean, na.rm=TRUE))
median_steps_imp <- data.table(aggregate(imputed ~ date, steps_taken, median, na.rm = TRUE))
```
The mean number of steps per day are.

```{r}
mean_steps_imp
```

The median number of steps per day are.

```{r}
median_steps_imp
```

Inspection reveals that the 8 missing days now have reported means and medians with the medians non-zero for the days with iputed values. This contrasts with other days where zeroes make up at least 50% of daily measuments.

Clearly, there should be no differences, other than for the eight days with imputed step measurements, between the original daily means and the daily means with imputed values. This is confirmed in the following table comparing the means before and after imputation:

```{r}
setkey(mean_steps,date)
setkey(mean_steps_imp,date)
compare_means <- merge(mean_steps,mean_steps_imp)
compare_means$diff <- compare_means$imputed - compare_means$steps
compare_means
```

The impact of the imputation is to provide measurements for eight complete days where no steps were measured. A better imputation regime could take account of the presence 50% of time periods there were zero steps measured, perhaps relating to resting, sleeping and other non-movement activities.

## Weekday and Weekend Activity Patterns ##

A factor variable **daytype** is added to the *steps_taken* data table. The factor is coded **weekend** if date falls on the Saturday or Sunday and **weekday** otherwise.

```{r}
steps_taken$daytype <- as.factor(ifelse(weekdays(as.POSIXct(steps_taken$date))=="Saturday" 
                                        | weekdays(as.POSIXct(steps_taken$date))=="Sunday",
                                        "weekend","weekday"))
```

Weekend and weekday activity is compared in the following panel plot:

```{r fig.width=7, fig.height=6}
by_interval <- data.table(aggregate(imputed ~ interval + daytype, steps_taken, mean, na.rm=TRUE))
p <- ggplot(by_interval, aes(x=interval, y=imputed))+ geom_line(colour = "blue")
p <- p + xlab("Interval") + ylab("Mean number of steps per interval") 
p + facet_grid(daytype ~ .) +
  theme(strip.text = element_text(face="bold", size=rel(1.5)),
        strip.background = element_rect(fill="lightblue", colour="black", size=1))
```

The subject is more active earlier in the morning on weekdays and more active later at night on weekends.